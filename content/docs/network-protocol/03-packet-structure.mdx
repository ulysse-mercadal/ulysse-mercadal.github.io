---
title: Packet Structure
description: Binary format used for all messages in the R-Type Protocol, over both TCP and UDP.
---

# Packet Structure

The R-Type Protocol uses a **uniform binary packet format** for **all communication**, whether sent over **TCP** (e.g., during handshake or reliable control messages) or **UDP** (for real-time gameplay updates). This ensures consistency across transport layers while allowing the protocol to remain transport-agnostic at the message level.

## General Rules

- **Maximum size per packet**: **512 bytes** (including header and body).
- A single packet may contain **one or more concatenated commands**.
- If the total data exceeds 512 bytes, it **must be split** into multiple packets.
- Each **command** is self-contained and consists of a **2-byte header** + an optional **body** (0 to 510 bytes).
- **command bodies are optional**: some commands have an empty body (`body length = 0`), while others carry structured game data.

> **Note**: Even during the **TCP handshake phase**, messages follow this exact format. The transport layer (TCP vs. UDP) affects delivery guarantees and latency, **not** the message encoding.

---

## command Format

Each command starts with a **2-byte (16-bit) header**, followed by a body whose length is declared in the header.

### Header Layout (2 bytes)

| Bits     | Field           | Description |
|----------|-----------------|-------------|
| 15–14    | Direction       | 2-bit direction code (e.g., `00` = request, `01` = response — semantics defined by context) |
| 13–9     | command ID  | 5-bit unsigned integer (0–31) identifying the command type |
| 8–0      | Body Length     | 9-bit unsigned integer (0–511) indicating the size of the body **in bytes** |

> The **body length does not include** the 2-byte header… well because a header is not a body :)

#### Visual bit layout:

|1|2|3|4|5|6|7|8| |9|10|11|12|13|14|15|16|
|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|
|D|D|I|I|I|I|I|L| |L|L|L|L|L|L|L|L|

> Where:
> - `D` = Direction (2 bits -> 4 possible values)
> - `I` = command ID (5 bits -> max 31)
> - `L` = Body length (9 bits -> max 511,)
---

## Usage Across Transports

| Transport | Typical Use Case                            | Packet Handling |
|----------|---------------------------------------------|-----------------|
| **TCP**  | Handshake, authentication, session setup, reliable commands | Packets are sent as a **stream**; the receiver must **frame** messages using the known 2-byte header + declared body length to delimit commands. |
| **UDP**  | Real-time gameplay (inputs, state updates)  | Each datagram contains **one full packet** (≤512 bytes). Multiple commands may be batched, but the entire datagram must fit in one UDP payload. |

> Because the same format is used on both transports, **serialization and parsing logic can be shared** between TCP and UDP code paths.

---

## Example

An `EXAMPLE` command (ID = 10) with a 4-byte body sent with direction code `01`:
- Direction = `01`
- ID = `10` -> binary `01010`
- Body length = `4` -> binary `000000100`

Full 16-bit header (big-endian):
`01 01010 000000100` -> grouped as two bytes:
- Byte 0: `01010100` = `0x54`
- Byte 1: `00000100` = `0x04`

Header sent: `0x54 0x04`
Followed by 4 bytes of payload data.
